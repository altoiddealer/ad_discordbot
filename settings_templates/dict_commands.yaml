# Configuration for the "Custom Commands" feature
# Read the Wiki for more information (https://github.com/altoiddealer/ad_discordbot/wiki/Custom-Commands)

# Tip: You can run "workflows" via the 'run_workflow' step (defined in dict_workflows.yaml), which can help reduce redundancy when using same steps in multiple commands.


# These are invoked by right-clicking a Message or User.
context_commands: [] # (delete brackets when actually adding commands using the '-' list item notation)

# These are invoked by typing /command_name in discord's UI text box.
slash_commands: [] # (delete brackets when actually adding commands using the '-' list item notation)


# These have no effect unless moved up into 'context_commands'
context_commands_examples:
  - command_name: test_context
    description: Test the new custom contaxt commands
    target_type: message   # or "user"
    queue_to: gen_queue
    steps:
      - send_content: You used a context command!

# These have no effect unless moved up into 'slash_commands'
slash_commands_examples:
  # Command to remove background from an image
  - command_name: remove_bg
    description: Remove the background from an image, with optional threshold value
    allow_dm: true # optional - defaults to 'false' if not included. Allows the cmd to be used via DM.
    options:
      - name: rembg_image
        description: The image to remove the background from
        type: attachment
        required: true
        steps:
          - save:
              file_path: comfy-input # This should be a symlink from comfyUI input directory, to your output directory.
              timestamp: false       # Override default timestamp (which could make duplicate inputs in the input dir)
            returns: file_name       # Extract filename from save result dict
      - name: threshold
        description: Adjusts the strength of the edge detection
        type: string
        required: false
        choices: [0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0]
    # All selection data will be initialzed into context (can be used to resolve payload fields, etc)
    steps:
      - load_data_file: comfy_workflows/comfy_remove_bg.json
      - call_comfy:
          client: ComfyUI
          message: Removing background from image
          file_path: comfy

  # Command to use Klein 9B to edit an image with optional reference image
  - command_name: klein_edit
    description: Edit an image using Flux 2 Klein 9B
    options:
      - name: image
        description: The image to edit
        type: attachment
        required: true
        steps:
          - save:
              file_path: comfy-input # symlink from comfyUI input directory, to your output directory.
            returns: file_name # Extract filename from save result dict
      - name: prompt
        description: Describe what changes you want made to the image
        type: string
        required: true
      - name: ref_image
        description: Optional reference image for the model to factor to final image result
        type: attachment
        required: false
        steps:
          - save:
              file_path: comfy-input
            returns: file_name
      - name: resolution
        description: Set the output resolution
        type: int
        required: false
        choices: [768, 1024, 1280, 1536, 2048]
    # /klein_edit postprocessing steps
    steps:
      - load_data_file: comfy_workflows/klein_image_edit_9b.json
        save_as: klein_payload
      - if:
          value1: ref_image
          operator: notexists
          steps:
            - comfy_delete_nodes:
                input_data: "{klein_payload}"
                delete_nodes: 81  # Delete Load Image2 node
                delete_until: 101 # deletes/reroutes connections until reaching CFG Guider node
      - load_llmmodel: 'None'
      - call_comfy:
          client: ComfyUI
          message: Editing your image
          file_path: comfy/klein_edit # saves result to 'output/comfy/klein_edit/'
        save_as: result
      - offload: true # Remove task early / immediately releases a position in the task processing queue
      - send_content: "**Prompt**: {prompt}"
      - return: result

  - command_name: echo_file
    description: Send an attachment
    options:
      - name: file
        description: File to send
        type: attachment # discord Attachment field
        required: true
        # example of per-option steps
        steps:
          - send_content: '{result}' # '{result}' will always resolve from input data, or previous step result.

  - command_name: echo
    description: Echo a message
    options:
      - name: message
        description: The message to echo
        type: string # text field
        required: true
    # example for steps after options are processed
    steps:
      - send_content: '{message}' # Context variables are inherited from option name by default

  # **These are valid command definitions, but actually handling these discord admin-type "steps" is not yet implemented**
  - command_name: assign_role
    description: Assign a role to a user
    options:
      - name: user
        description: The user to assign a role to
        type: user
        required: true
      - name: role
        description: The role to assign
        type: role
        required: true

  - command_name: move_user
    description: Move a user to a channel
    options:
      - name: user
        description: The user to move
        type: user
        required: true
      - name: channel
        description: The channel to move the user to
        type: channel
        required: true

  - command_name: set_volume
    description: Set the volume level
    options:
      - name: level
        description: Volume level (0.0 - 1.0)
        type: float
        required: true

  - command_name: set_color
    description: Pick a color
    options:
      - name: color
        description: Your favorite color
        type: string
        required: true
        choices:
          - name: Red
            value: "#FF0000"
          - name: Green
            value: "#00FF00"
          - name: Blue
            value: "#0000FF"

  - command_name: ban_user
    description: Ban a user with optional reason and delete message days
    options:
      - name: user
        description: User to ban
        type: user
        required: true
      - name: reason
        description: Reason for ban
        type: string
        required: false
      - name: delete_days
        description: Days of messages to delete (0-7)
        type: int
        required: false

  - command_name: choose
    description: Choose between two options
    options:
      - name: option1
        description: First option
        type: string
        required: true
      - name: option2
        description: Second option
        type: string
        required: true

  - command_name: notify
    description: Notify a mentionable (user or role)
    options:
      - name: target
        description: User or role to notify
        type: mentionable
        required: true

  - command_name: report_bug
    description: Report a bug with optional urgency
    options:
      - name: description
        description: Describe the bug
        type: string
        required: true
      - name: urgent
        description: Is it urgent?
        type: bool
        required: false
